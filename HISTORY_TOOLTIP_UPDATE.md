# 歷史數據分析 Tooltip 改進說明

## 📋 更新內容

優化了球員歷史數據分析圖表的 hover 提示框（Tooltip），新增了更多有用的資訊並改善了視覺呈現。

---

## ✨ 新增功能

### 1. **顯示上場時間**
- 顯示該場比賽的上場時間（分鐘）
- 格式：`⏱️ 上場時間: XX.X 分鐘`
- 幫助用戶判斷數據的參考價值

### 2. **顯示是否先發**
- ⭐ **先發**：以琥珀色高亮顯示
- 🪑 **替補**：以灰色顯示
- 一目了然球員的出場身份

### 3. **改善字體顏色**
- **修正前**：黑色字體在深色背景下看不清楚
- **修正後**：
  - 主要文字：`#e2e8f0`（淺灰色）
  - 標題文字：`#f1f5f9`（更淺的灰色）
  - 數值文字：`#f8fafc`（接近白色）
  - Over：`#10b981`（翡翠綠）
  - Under：`#f43f5e`（玫瑰紅）

---

## 🎨 視覺優化

### Tooltip 佈局改進

```
┌────────────────────────────────────────┐
│ 📅 2026-01-15 vs Lakers                │ ← 標題（白色粗體）
├────────────────────────────────────────┤
│ 得分                                    │ ← 指標名稱
│                                         │
│   28.5  [Over]                         │ ← 數值 + 標籤（綠色/紅色）
│                                         │
│   ⏱️ 上場時間: 32.5 分鐘               │ ← 新增：上場時間
│   ⭐ 先發                               │ ← 新增：先發狀態
└────────────────────────────────────────┘
```

### 樣式細節
- **背景色**：`#1e293b`（深藍灰色）
- **邊框**：`1px solid #475569`（中灰色）
- **圓角**：`12px`（更圓潤）
- **內距**：`12px`（更寬敞）
- **標題分隔線**：底部邊框區分標題和內容

---

## 📝 修改的檔案

### 1. **後端：`backend/app/services/csv_player_history.py`**

#### 修改 1：讀取先發狀態
```python
# 解析先發狀態
status = row.get("Status", "").strip()
is_starter = status.lower() == "starter"

game_log = {
    # ... 其他欄位
    "status": status,  # "Starter" 或 "Bench"
    "is_starter": is_starter,  # 布林值
}
```

#### 修改 2：輸出到 API
```python
valid_games.append({
    # ... 原有欄位
    "minutes": round(minutes, 1),  # 上場時間
    "is_starter": is_starter,  # 是否先發
})
```

### 2. **前端 Schema：`frontend/lib/schemas.ts`**

```typescript
export const gameLogSchema = z.object({
  // ... 原有欄位
  minutes: z.number().optional().default(0),  // 新增
  is_starter: z.boolean().optional().default(false),  // 新增
});
```

### 3. **前端組件：`frontend/components/PlayerHistoryStats.tsx`**

#### Tooltip 內容優化
- 使用 JSX 組件渲染更豐富的內容
- 動態顏色根據 Over/Under 狀態變化
- 新增上場時間和先發狀態顯示
- 改善文字顏色對比度

---

## 🔍 使用效果

### 使用者體驗改進

1. **更完整的資訊**
   - 不只看到得分/助攻等數值
   - 還能看到上場時間和先發狀態
   - 幫助判斷數據的可靠性

2. **更好的可讀性**
   - 字體顏色清晰可見
   - 資訊層次分明
   - 視覺引導明確

3. **更直觀的判斷**
   - 先發球員通常數據更穩定
   - 上場時間長短影響表現
   - 一眼就能看出關鍵資訊

---

## 📊 數據來源

所有資訊都來自 CSV 檔案的欄位：
- `MIN`：上場時間（格式：`MM:SS` 或數字）
- `Status`：先發狀態（`Starter` 或 `Bench`）

---

## 🎯 實際範例

### Hover 前
```
得分: 28.5 (Over)
2026-01-15 vs Lakers
```

### Hover 後
```
📅 2026-01-15 vs Lakers
━━━━━━━━━━━━━━━━━━━━━━━━
得分

  28.5  [Over]

  ⏱️ 上場時間: 32.5 分鐘
  ⭐ 先發
```

---

## ⚠️ 注意事項

1. **數據完整性**
   - 部分舊數據可能缺少 `Status` 欄位
   - 系統會自動處理，顯示為替補（預設值）

2. **上場時間格式**
   - CSV 支援 `MM:SS` 和數字兩種格式
   - 後端會自動轉換為小數分鐘數

3. **瀏覽器兼容性**
   - 使用標準 CSS 和 React
   - 支援所有現代瀏覽器

---

## 🚀 後續可優化項目

1. **統計摘要**
   - 在卡片區顯示平均上場時間
   - 顯示先發場次 vs 替補場次比例

2. **篩選功能**
   - 只看先發場次的數據
   - 只看上場時間 > X 分鐘的比賽

3. **視覺化增強**
   - 在圖表上用不同顏色區分先發/替補
   - 用柱狀圖高度表示上場時間

4. **更多資訊**
   - 投籃命中率
   - 正負值（+/-）
   - 效率值（PER）

---

**更新日期**：2026-01-25  
**版本**：v1.2  
**影響範圍**：歷史數據分析模組

